
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rolevo System Handover</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max_width: 900px;
            margin: 0 auto;
            padding: 40px;
            color: #333;
        }
        @media print {
            body {
                max_width: 100%;
                padding: 0;
            }
            .no-print {
                display: none;
            }
        }
        h1, h2, h3 { color: #2c3e50; margin-top: 1.5em; }
        h1 { border-bottom: 2px solid #eee; padding-bottom: 10px; }
        h2 { border-bottom: 1px solid #eee; padding-bottom: 5px; }
        code { background: #f4f4f4; padding: 2px 5px; border-radius: 3px; font-family: Consolas, monospace; }
        pre { background: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; }
        pre code { background: none; padding: 0; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f8f9fa; }
        img { max-width: 100%; }
        .mermaid { margin: 30px 0; text-align: center; }
        .alert { padding: 15px; margin: 20px 0; border-left: 5px solid #333; background: #f9f9f9; }
    </style>
</head>
<body>
    <div class="no-print" style="background: #e1f5fe; padding: 15px; border-radius: 5px; margin-bottom: 20px; border: 1px solid #b3e5fc; color: #01579b;">
        <strong>üñ®Ô∏è Instructions:</strong> Right-click and select "Print", then choose "Save as PDF" to get the final PDF document.
    </div>

    <div id="content"></div>

    <script>
        const mdContent = "# Rolevo System Handover Documentation\n\n\n**Date:** February 6, 2026  \n**Application:** Rolevo - AI-Powered Roleplay Assessment Platform\n\n---\n\n## Table of Contents\n\n1. [Overall Architecture](#overall-architecture)\n2. [Infrastructure Details](#infrastructure-details)\n3. [URLs and Credentials](#urls-and-credentials)\n4. [Git Repository](#git-repository)\n5. [API Keys](#api-keys)\n6. [Log Paths](#log-paths)\n7. [Configuration Details](#configuration-details)\n8. [GenAI Configuration](#genai-configuration)\n9. [Test Scenarios](#test-scenarios)\n10. [Known Issues](#known-issues)\n11. [Deployment Guide](#deployment-guide)\n\n---\n\n## Overall Architecture\n\n```mermaid\ngraph TB\n    %% Styling\n    classDef box fill:#fff,stroke:#333,stroke-width:1px;\n    \n    subgraph ClientLayer[\"CLIENT LAYER\"]\n        direction LR\n        C1[\"User Browser<br/>(Assessment UI)\"]:::box\n        C2[\"Admin Browser<br/>(Dashboard)\"]:::box\n        C3[\"Q3 / AIO System<br/>(Integration APIs)\"]:::box\n    end\n\n    ClientLayer ==> AppLayer\n\n    subgraph AppLayer[\"APPLICATION LAYER (Flask on PythonAnywhere)\"]\n        direction TB\n        \n        subgraph Routes[\"Routes & Controllers\"]\n            direction LR\n            R1[\"routes.py<br/>(Admin, User Views)\"]:::box\n            R2[\"api_integration.py<br/>(Q3 Handshakes)\"]:::box\n            R3[\"auth<br/>(Login/SSO)\"]:::box\n        end\n\n        subgraph Services[\"Services & Logic\"]\n            direction LR\n            S1[\"tts_service.py<br/>(AWS Polly)\"]:::box\n            S2[\"persona360_service.py<br/>(16PF)\"]:::box\n            S3[\"report_generator.py<br/>(Reporting)\"]:::box\n        end\n\n        subgraph DataAccess[\"Data Access & Utils\"]\n            direction LR\n            D1[\"queries.py<br/>(DB Operations)\"]:::box\n            D2[\"security.py<br/>(JWT/CSRF)\"]:::box\n        end\n        \n        Routes --- Services\n        Services --- DataAccess\n    end\n\n    AppLayer ==> DataLayer\n\n    subgraph DataLayer[\"DATA LAYER\"]\n        direction LR\n        DB[(\"MySQL Database<br/>\u2022 Users & Config<br/>\u2022 Roleplays & Clusters<br/>\u2022 Scores & Logs\")]:::box\n        FS[(\"File Storage<br/>\u2022 Generated Audio (TTS)<br/>\u2022 Uploaded Images/Excel<br/>\u2022 PDF/PPTX Reports\")]:::box\n    end\n```\n\n### Component Overview\n\n| Component | Technology | Purpose |\n|-----------|------------|---------|\n| **Web Framework** | Flask (Python 3.x) | Request handling, routing, templates |\n| **Database** | MySQL | User data, roleplays, scores, clusters |\n| **AI Chat** | OpenAI GPT-4 | Roleplay conversation generation |\n| **Text-to-Speech** | AWS Polly (Neural) | Character voice synthesis |\n| **Voice Analysis** | Persona360 API | 16PF personality assessment from audio |\n| **Hosting** | PythonAnywhere | Production deployment |\n\n---\n\n## Infrastructure Details\n\n### Production Environment\n\n| Item | Value |\n|------|-------|\n| **Hosting Provider** | PythonAnywhere |\n| **Web App Type** | Flask WSGI |\n| **Python Version** | 3.x |\n| **Web Server** | PythonAnywhere built-in |\n| **SSL** | Enabled (HTTPS) |\n\n### Database (MySQL)\n\n| Parameter | Value |\n|-----------|-------|\n| **Host** | `trajectoriesolutions.mysql.pythonanywhere-services.com` |\n| **User** | `trajectoriesolut` |\n| **Database** | `trajectoriesolut$default` |\n| **Password** | `Rolevotraj324@` |\n\n### Key Tables\n\n| Table | Purpose |\n|-------|---------|\n| `users` | User accounts (admin, candidates) |\n| `roleplay` | Roleplay definitions (scenarios) |\n| `roleplay_cluster` | Cluster groupings for assessments |\n| `roleplay_config` | Per-roleplay settings (time, 16PF) |\n| `play` | Session records for each attempt |\n| `score` | Competency scores per play |\n| `integration_tokens` | SSO tokens for Q3 integration |\n\n---\n\n## URLs and Credentials\n\n### Production URLs\n\n| Purpose | URL |\n|---------|-----|\n| **Main Application** | `https://roleplays.trajectorie.com` |\n| **Admin Login** | `https://roleplays.trajectorie.com/login` |\n| **Assessment Launch API** | `https://roleplays.trajectorie.com/api/integration/assessment-launch` |\n| **PythonAnywhere Console** | `https://www.pythonanywhere.com/user/trajectoriesolutions/` |\n\n### Admin Credentials\n\n| Field | Value |\n|-------|-------|\n| **Username** | `admin` |\n| **Password** | *(Contact system administrator)* |\n\n---\n\n## Git Repository\n\n| Item | Value |\n|------|-------|\n| **Repository** | Local development only |\n| **Primary Branch** | `main` |\n| **Project Path** | `Rolevo-flaskapp-firas/` |\n\n### Key Directories\n\n```\nRolevo-flaskapp-firas/\n\u251c\u2500\u2500 app/                    # Main application code\n\u2502   \u251c\u2500\u2500 __init__.py         # Flask app factory\n\u2502   \u251c\u2500\u2500 routes.py           # All route handlers\n\u2502   \u251c\u2500\u2500 api_integration.py  # Q3 integration APIs\n\u2502   \u251c\u2500\u2500 queries.py          # Database queries\n\u2502   \u251c\u2500\u2500 tts_service.py      # AWS Polly TTS\n\u2502   \u251c\u2500\u2500 persona360_service.py # 16PF voice analysis\n\u2502   \u2514\u2500\u2500 templates/          # Jinja2 HTML templates\n\u251c\u2500\u2500 data/                   # Uploaded files\n\u2502   \u251c\u2500\u2500 roleplay/           # Roleplay Excel files\n\u2502   \u251c\u2500\u2500 master/             # Competency files\n\u2502   \u2514\u2500\u2500 images/             # Uploaded images\n\u251c\u2500\u2500 static/                 # CSS, JS, generated audio\n\u251c\u2500\u2500 integration_docs/       # Q3 integration documentation\n\u251c\u2500\u2500 config.py               # Application configuration\n\u251c\u2500\u2500 roleplay.py             # App entry point\n\u2514\u2500\u2500 .env                    # Environment variables\n```\n\n---\n\n## API Keys\n\n> [!CAUTION]\n> **SECURITY**: These keys are for reference. Use environment variables in production.\n\n### OpenAI (GenAI)\n\n| Key | Environment Variable |\n|-----|---------------------|\n| **API Key** | `OPENAI_API_KEY` |\n| **Model Used** | `gpt-4` / `gpt-4-turbo` |\n\n### AWS (Polly TTS)\n\n| Key | Environment Variable |\n|-----|---------------------|\n| **Access Key ID** | `AWS_ACCESS_KEY_ID` |\n| **Secret Access Key** | `AWS_SECRET_ACCESS_KEY` |\n| **Region** | `AWS_REGION` (us-east-1) |\n\n### Persona360 (16PF Analysis)\n\n| Key | Environment Variable |\n|-----|---------------------|\n| **API URL** | `PERSONA360_API_URL` |\n| **API Key** | `PERSONA360_API_KEY` |\n\n### Q3 Integration\n\n| Key | Environment Variable |\n|-----|---------------------|\n| **Shared Secret** | `Q3_INTEGRATION_SECRET` |\n| **JWT Secret** | `JWT_SECRET_KEY` |\n\n---\n\n## Log Paths\n\n### PythonAnywhere\n\n| Log Type | Path |\n|----------|------|\n| **Error Log** | `/var/log/trajectoriesolutions.pythonanywhere.com.error.log` |\n| **Server Log** | `/var/log/trajectoriesolutions.pythonanywhere.com.server.log` |\n| **Access Log** | *(Available in Web tab)* |\n\n### Application Logs\n\n- Console output via `print()` statements\n- Debug logs: `[DEBUG]`, `[TTS]`, `[API Integration]` prefixes\n\n---\n\n## Configuration Details\n\n### Environment Variables (`.env`)\n\n```bash\n# GenAI Configuration\nOPENAI_API_KEY=sk-...\nTTS_PROVIDER=aws  # Options: 'openai', 'aws'\n\n# AWS Polly\nAWS_ACCESS_KEY_ID=AKIA...\nAWS_SECRET_ACCESS_KEY=...\nAWS_REGION=us-east-1\n\n# Database\nDB_HOST=trajectoriesolutions.mysql.pythonanywhere-services.com\nDB_USER=trajectoriesolut\nDB_PASSWORD=Rolevotraj324@\nDB_NAME=trajectoriesolut$default\n\n# Application\nSECRET_KEY=<secure-random-key>\nFLASK_ENV=production\n\n# 16PF Voice Analysis\nPERSONA360_API_URL=http://api.persona360.rapeti.dev:8290/predict\nPERSONA360_API_KEY=sk_...\n\n# Q3 Integration\nQ3_INTEGRATION_SECRET=qYx9f4K8mZ2V7cW6e1D0B3TQJvLkH5pA0N6M4RrS8E=\nJWT_SECRET_KEY=...\n\n# Email\nSMTP_SERVER=smtp.gmail.com\nSMTP_PORT=587\n```\n\n### Roleplay Configuration (`roleplay_config` table)\n\n| Field | Description |\n|-------|-------------|\n| `max_total_time` | Maximum time in seconds |\n| `enable_16pf_analysis` | Enable voice personality analysis |\n| `audio_rerecord_attempts` | Number of re-record attempts allowed |\n\n---\n\n## GenAI Configuration\n\n### Current Setup\n\n| Component | Provider | Model |\n|-----------|----------|-------|\n| **Chat/Conversation** | OpenAI | GPT-4 |\n| **Text-to-Speech** | AWS Polly | Neural Voices |\n\n### Switching GenAI Providers\n\n#### Option 1: Switch TTS Provider\n\n```python\n# In .env:\nTTS_PROVIDER=aws      # For AWS Polly (current)\nTTS_PROVIDER=openai   # For OpenAI TTS\n```\n\nThe `tts_service.py` automatically selects based on this variable.\n\n#### Option 2: Switch Chat Provider\n\nTo switch from OpenAI to another LLM:\n\n1. **File to modify**: `app/routes.py`\n2. **Function**: `ask_llm()` or equivalent chat function\n3. **Replace**: OpenAI API calls with new provider SDK\n\n**Example structure for Azure OpenAI:**\n```python\nimport openai\nopenai.api_type = \"azure\"\nopenai.api_base = \"https://your-resource.openai.azure.com/\"\nopenai.api_version = \"2023-05-15\"\nopenai.api_key = os.environ.get(\"AZURE_OPENAI_KEY\")\n```\n\n#### Option 3: Switch to Local LLM\n\nFor on-premise deployment:\n1. Set up Ollama or vLLM server\n2. Modify API calls to point to local endpoint\n3. Update model name references\n\n---\n\n## Test Scenarios\n\n### 1. Q3 Integration Test\n\n```bash\npython verify_q3_integration.py\n```\n\n**Expected Result**: `\u2705 ROLEVO IS READY FOR Q3 INTEGRATION`\n\n### 2. Assessment Launch Flow\n\n| Step | Expected |\n|------|----------|\n| POST `/api/integration/assessment-launch` | `success: true`, `redirect_url` returned |\n| User redirected to assessment | Dashboard loads |\n| Complete roleplay | Scores calculated |\n| Results callback | POST to `results_url` |\n\n### 3. TTS Generation\n\n| Test | Expected |\n|------|----------|\n| Character speaks | Audio file generated |\n| Different genders | Correct voice gender |\n| Indian languages | en-IN voices used |\n\n### 4. 16PF Voice Analysis\n\n| Test | Expected |\n|------|----------|\n| Audio submitted to Persona360 | JSON response with personality factors |\n| Merged into report | 16PF section populated |\n\n---\n\n## Known Issues\n\n### Issue 1: Session Timeout During Long Roleplays\n\n**Symptom**: User session expires during 30+ minute roleplays  \n**Resolution**: Increase `PERMANENT_SESSION_LIFETIME` in `config.py`\n\n### Issue 2: TTS Cache Growth\n\n**Symptom**: Disk usage increases over time  \n**Resolution**: Periodically clear `/tmp/rolevo_tts_cache/` or `static/generated_tts/`\n\n### Issue 3: Excel File Format Errors\n\n**Symptom**: Competency file upload fails  \n**Resolution**: Ensure `.xlsx` format with correct column headers\n\n---\n\n## Deployment Guide\n\n### Deploying to PythonAnywhere\n\n1. **Upload Files**:\n   ```\n   app/api_integration.py\n   app/routes.py\n   app/queries.py\n   app/tts_service.py\n   ```\n\n2. **Set Environment Variables**:\n   - Navigate to Web \u2192 WSGI configuration\n   - Or create/update `.env` file\n\n3. **Reload Web App**:\n   - Web tab \u2192 Click \"Reload\"\n\n4. **Verify**:\n   - Check error log for issues\n   - Run `verify_q3_integration.py` locally\n\n### Post-Deployment Checklist\n\n- [ ] All environment variables set\n- [ ] Database migrations applied\n- [ ] Static files accessible\n- [ ] TTS generating audio\n- [ ] Q3 integration test passing\n- [ ] Error log clean\n\n---\n\n## Contact Information\n\n| Role | Contact |\n|------|---------|\n| **Development** | *(Your contact)* |\n| **Q3 Integration** | Q3 Team |\n| **Hosting (PythonAnywhere)** | support@pythonanywhere.com |\n\n---\n\n*Document generated for production handover. Last verified: February 6, 2026*\n";
        
        // Configure marked options
        marked.setOptions({
            highlight: function(code, lang) {
                if (lang === 'mermaid') {
                    return '<div class="mermaid">' + code + '</div>';
                }
                return code;
            }
        });

        const renderer = new marked.Renderer();
        const originalCode = renderer.code.bind(renderer);
        
        renderer.code = (code, language) => {
            if (language === 'mermaid') {
                return `<div class="mermaid">${code}</div>`;
            }
            return originalCode(code, language);
        };

        const htmlContent = marked.parse(mdContent, { renderer });
        document.getElementById('content').innerHTML = htmlContent;
        
        // Initialize mermaid after content is loaded
        setTimeout(() => {
            mermaid.initialize({ 
                startOnLoad: true, 
                theme: 'default',
                securityLevel: 'loose',
            });
            mermaid.init(undefined, document.querySelectorAll('.mermaid'));
        }, 100);
    </script>
</body>
</html>
    